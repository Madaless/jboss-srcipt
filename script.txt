# Ścieżki
$zipFile = "C:\ścieżka\do\jboss.7z"
$targetDir = "C:\ścieżka_do_JBoss"
$sevenZip = "C:\Program Files\7-Zip\7z.exe"  # zmień jeśli 7z jest gdzie indziej

# 0. Usuń stary katalog
try {
    if (Test-Path $targetDir) {
        Write-Host "Usuwanie starego katalogu JBoss..."
        Remove-Item -Path $targetDir -Recurse -Force -ErrorAction Stop
    }
} catch {
    Write-Host "Błąd podczas usuwania starego katalogu:" $_
}

# 1. Rozpakowanie archiwum 7z
try {
    Write-Host "Rozpakowywanie JBoss..."
    & "$sevenZip" x "$zipFile" -o"$targetDir" -y
} catch {
    Write-Host "Błąd podczas rozpakowywania:" $_
}

# 2. Funkcja do zamiany tekstu w plikach
function Replace-TextInFiles {
    param([string]$Path,[string]$OldText,[string]$NewText)

    Get-ChildItem -Path $Path -Recurse -File | ForEach-Object {
        try {
            $content = Get-Content $_.FullName -Raw -ErrorAction Stop
            if ($content -match [regex]::Escape($OldText)) {
                $content = $content -replace [regex]::Escape($OldText), $NewText
                Set-Content -Path $_.FullName -Value $content -ErrorAction Stop
                Write-Host "Zmieniono w pliku: $($_.FullName)"
            }
        } catch {
            Write-Host "Błąd w pliku $($_.FullName): $_"
        }
    }
}

# 3. Zamiana tekstów tylko w standalone/configuration
Write-Host "Zamiana tekstów tylko w standalone/configuration..."
$confDir = Join-Path $targetDir "standalone\configuration"
Replace-TextInFiles -Path $confDir -OldText "XE34C" -NewText "YU60HC"
Replace-TextInFiles -Path $confDir -OldText "xe63hc" -NewText "YU60HC"
Write-Host "Gotowe."
